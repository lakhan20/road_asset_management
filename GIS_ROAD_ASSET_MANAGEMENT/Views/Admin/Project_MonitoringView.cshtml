@model List<GIS_ROAD_ASSET_MANAGEMENT.Models.MonitoringViewModel>
@{
    Layout = "~/Views/Shared/_Layout2.cshtml";
}



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.3/css/dataTables.bootstrap5.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/2.3.0/css/searchPanes.bootstrap5.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/2.0.0/css/select.bootstrap5.css">
    <script src="https://kit.fontawesome.com/yourcode.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.5/css/dataTables.dataTables.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/2.3.1/css/searchPanes.dataTables.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/2.0.1/css/select.dataTables.css">

    <title>Document</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <!-- Smart Wizard CSS -->
    <link href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/smart_wizard.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/smart_wizard_theme_dots.min.css"
          rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="style.css">
    <!-- Your form and script -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- google font -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">

    <!-- JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


    <!-- OpenLayers CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v9.1.0/ol.css">
    <style>
        .container {
            width: 100%;
            max-width: none;
            padding-right: 15px;
            padding-left: 15px;
            margin-right: auto;
            margin-left: auto;
        }
        /* Your custom styles here */
        body {
            font-family: 'Open Sans', sans-serif;
        }

        #addProjectForm {
            max-width: 500px;
            background-color: #ffffff;
            box-shadow: 0px 6px 18px rgb(0 0 0 / 9%);
            border-radius: 12px;
        }

            #addProjectForm .form-header {
                gap: 5px;
                text-align: center;
                font-size: .9em;
            }

                #addProjectForm .form-header .stepIndicator {
                    position: relative;
                    flex: 1;
                    padding-bottom: 30px;
                }

                    #addProjectForm .form-header .stepIndicator.active {
                        font-weight: 600;
                    }

                    #addProjectForm .form-header .stepIndicator.finish {
                        font-weight: 600;
                        color: #000;
                    }

                    #addProjectForm .form-header .stepIndicator::before {
                        content: "";
                        position: absolute;
                        left: 50%;
                        bottom: 0;
                        transform: translateX(-50%);
                        z-index: 9;
                        width: 20px;
                        height: 20px;
                        background-color: #000;
                        border-radius: 50%;
                        border: 3px solid #000;
                    }

                    #addProjectForm .form-header .stepIndicator.active::before {
                        background-color: #28a745;
                        border: 3px solid #858796;
                    }

                    #addProjectForm .form-header .stepIndicator.finish::before {
                        background-color: #28a745;
                        border: 3px solid #28a745;
                    }

                    #addProjectForm .form-header .stepIndicator::after {
                        content: "";
                        position: absolute;
                        left: 50%;
                        bottom: 8px;
                        width: 100%;
                        height: 3px;
                        background-color: #f3f3f3;
                    }

                    #addProjectForm .form-header .stepIndicator.active::after {
                        background-color: #f3f3f3;
                    }

                    #addProjectForm .form-header .stepIndicator.finish::after {
                        background-color: #198754;
                    }

                    #addProjectForm .form-header .stepIndicator:last-child:after {
                        display: none;
                    }

            #addProjectForm input {
                padding: 15px 20px;
                width: 100%;
                font-size: 1em;
                border: 1px solid #e3e3e3;
                border-radius: 5px;
            }

                #addProjectForm input:focus {
                    border: 1px solid #000;
                    outline: 0;
                }

                #addProjectForm textarea.invalid,
                #addProjectForm select.invalid,
                #addProjectForm input.invalid {
                    border: 1px solid #ffaba5;
                }
            /*   #addProjectForm textarea.invalid {
                border: 5px solid #ffaba5;
            }*/
            #addProjectForm .step {
                display: none;
            }

            #addProjectForm .form-footer {
                overflow: auto;
                gap: 20px;
            }

                #addProjectForm .form-footer button {
                    background-color: #000;
                    border: 1px solid #000 !important;
                    color: #ffffff;
                    border: none;
                    padding: 13px 30px;
                    font-size: 1em;
                    cursor: pointer;
                    border-radius: 5px;
                    flex: 1;
                    margin-top: 5px;
                }

                    #addProjectForm .form-footer button:hover {
                        opacity: 0.8;
                    }

                #addProjectForm .form-footer #prevBtn {
                    background-color: #fff;
                    color: #000;
                }

        .btn-custom {
            background-color: #393939;
            color: #fff; /* Text color */
        }

        .error12 {
            color: red;
        }
        /* Set height for map container */
        #map {
            width: 100%;
            height: 400px; /* Set an initial height */
        }

        .break {
            display: block;
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }


        .container {
            width: 100%;
            max-width: none;
            padding-right: 15px;
            padding-left: 15px;
            margin-right: auto;
            margin-left: auto;
        }

        /* Style for the buttons */
        .btn-custom {
            background-color: #393939;
            color: #fff; /* Text color */
            /* Border color */
        }

        .form-footer {
            overflow: auto;
            gap: 20px;
        }

            .form-footer button {
                background-color: #000;
                border: 1px solid #000 !important;
                color: #ffffff;
                border: none;
                padding: 13px 30px;
                font-size: 1em;
                cursor: pointer;
                border-radius: 5px;
                flex: 1;
                margin-top: 5px;
            }

                .form-footer button:hover {
                    opacity: 0.8;
                }

        .modal-header {
            background-color: #282828
        }

        .modal-title {
            color: #fff
        }

        .map-footer button {
            background-color: #000;
            border: 1px solid #000 !important;
            color: #ffffff;
            border: none;
            padding: 13px 30px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
            flex: 1;
            margin-top: 5px;
        }

            .map-footer button:hover {
                opacity: 0.8;
            }

        .custom-btn {
            padding: 10px 20px; /* Adjusted padding */
            border: unset;
            border-radius: 10px; /* Adjusted border-radius */
            color: #212121;
            z-index: 1;
            background: #e8e8e8;
            position: relative;
            font-weight: 1000;
            font-size: 14px; /* Adjusted font size */
            -webkit-box-shadow: 4px 8px 19px -3px rgba(0,0,0,0.27);
            box-shadow: 4px 8px 19px -3px rgba(0,0,0,0.27);
            transition: all 250ms;
            overflow: hidden;
        }

            .custom-btn::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                width: 0;
                border-radius: 10px; /* Adjusted border-radius */
                background-color: #212121;
                z-index: -1;
                -webkit-box-shadow: 4px 8px 19px -3px rgba(0,0,0,0.27);
                box-shadow: 4px 8px 19px -3px rgba(0,0,0,0.27);
                transition: all 250ms;
            }

            .custom-btn:hover {
                color: #e8e8e8;
            }

                .custom-btn:hover::before {
                    width: 100%;
                }
    </style>

</head>
<body>
    @if (ViewBag.RoleId == 1 || ViewBag.RoleId == 2)
    {
        <div class="container-fluid">
            <div class="d-flex">
                <a class="navbar-brand mr-auto"><h2>Project Details</h2></a>
                <button class="btn btn-custom" id="mg" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="addPrj()"><i class="fa-solid fa-diagram-project"></i> Add Project</button>
                <button class="btn btn-custom mx-2" id="getCSV">
                    <i class="fas fa-file-csv"></i> Export to CSV
                </button>
                <button class="btn btn-custom mx-2" id="getPDF">
                    <i class="fas fa-file-pdf"></i> Export to PDF
                </button>
            </div>
        </div>
        <!-- Map Modal -->

        <div class="modal fade" id="mapModal" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="exampleModalToggleLabel">
            <!-- Modal content -->
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <!-- Modal content -->
                <div class="modal-content">
                    <div class="modal-header" style="background-color: #282828">
                        <h1 class="modal-title fs-5" id="exampleModalToggleLabel" style="color: #fff">Select Coordinates</h1>
                        <button type="button" class="btn-close btn-close-white" data-bs-toggle="modal" data-bs-target="#exampleModal" aria-label="Close">
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- Map container -->
                        <div id="map"></div>
                        <input id="road_data_hidden" type="hidden" />
                    </div>
                    <div class="modal-footer map-footer d-flex">
                        <button type="button" id="map_submit">Submit</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Modal -->

        <form id="addProjectForm" action="#!">
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <!-- Added modal-lg class for large size -->
                    <div class="modal-content">
                        <div class="modal-header" style="background-color: #282828 ">
                            <h1 class="modal-title fs-5" id="exampleModalToggleLabel" style="color: #fff">Project Details</h1>
                            <button type="button" class="btn-close btn-close-white " data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body modal-body-centered modal-lg">

                            <h1 class="text-center fs-4">Project Monitoring</h1>
                            <!-- start step indicators -->
                            <div class="form-header d-flex mb-4">
                                <span class="stepIndicator">Basic Details</span>
                                <span class="stepIndicator">Location</span>
                                <span class="stepIndicator">Documents</span>
                            </div>
                            <!-- end step indicators -->
                            <!-- step one -->
                            <div class="step">
                                <div class="row mb-3">
                                    <div class="col">
                                        <label for="projecttitle" class="form-label" id="project_title_label">Project Title</label>
                                        <input type="text" class="form-control" id="project_title">
                                        <small id="project_title_error" class="error-message text-danger"></small>
                                    </div>
                                    <div class="col">
                                        <label for="workorderno" class="form-label" id="work_order_no_label">Work Order Number</label>
                                        <input type="text" class="form-control" id="work_order_no">
                                        <small id="work_order_no_error" class="error-message text-danger"></small>

                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col">
                                        <label for="description" class="form-label" id="description_label">Description</label>
                                        <textarea class="form-control" id="description"></textarea>
                                        <small id="description_error" class="error-message text-danger"></small>

                                    </div>
                                </div> <div class="row mb-3">
                                    <div class="col">
                                        <label for="startdate" class="form-label" id="start_date_label">Start Date</label>
                                        <input type="date" class="form-control" id="start_date">
                                        <small id="start_date_error" class="error-message text-danger"></small>

                                    </div>
                                    <div class="col">
                                        <label for="enddate" class="form-label" id="end_date_label">End Date</label>
                                        <input type="date" class="form-control" id="end_date">
                                        <small id="end_date_error" class="error-message text-danger"></small>

                                    </div>
                                </div>
                            </div>

                            <!-- step two -->
                            <div class="step">
                                <div class="row mb-3">
                                    <h4>Start Point</h4>
                                    <div class="col">
                                        <label for="lat" class="form-label" id="s_latitude_label">Latitude</label>
                                        <input type="text" class="form-control" id="s_latitude" readonly>
                                        <small id="s_latitude_error" class="error-message text-danger"></small>

                                    </div>
                                    <div class="col">
                                        <label for="long" class="form-label" id="s_longitude_label">Longitude</label>
                                        <input type="text" class="form-control" id="s_longitude" readonly>
                                        <small id="s_longitude_error" class="error-message text-danger"></small>

                                    </div>
                                    <div class="col-2">
                                        <button id="start" type="button" class="btn btn-custom" data-bs-toggle="modal" data-bs-target="#mapModal" border-color: black;">
                                            <i style='font-size:24px' class='fas'>&#xf5a0;</i>
                                        </button>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <h4>End Point</h4>
                                    <div class="col">
                                        <label for="lat" class="form-label" id="e_latitude_label">Latitude</label>
                                        <input type="text" class="form-control" id="e_latitude" readonly>
                                        <small id="e_latitude_error" class="error-message text-danger"></small>

                                    </div>
                                    <div class="col">
                                        <label for="long" class="form-label" id="e_longitude_label">Longitude</label>
                                        <input type="text" class="form-control" id="e_longitude" readonly>
                                        <small id="e_longitude_error" class="error-message text-danger"></small>

                                    </div>
                                    @*<div class="col-2">
                                            <button id="end" type="button" class="btn btn-custom" data-bs-toggle="modal" data-bs-target="#mapModal" border-color: black;">
                                                <i style='font-size:24px' class='fas'>&#xf5a0;</i>
                                            </button>
                                        </div>*@

                                </div>
                                <div class="row mb-3">
                                    <small id="e_longitude_error" class="error-message text-danger"></small>
                                </div>
                                <div class="row mb-3">
                                    <div class="col">
                                        <label for="projecttype" class="form-label">Project Type</label>
                                        <select class="form-select" id="project_type">
                                            <option selected value="0">Choose Project Type...</option>
                                            <option value="1">foot bridge</option>
                                            <option value="2">road cc</option>
                                            <option value="3">subway/ underpass</option>
                                            <option value="4">track and footpath</option>
                                        </select>
                                    </div>
                                    <div class="col">
                                        <label for="budget" class="form-label">Budget</label>
                                        <input type="text" class="form-control" id="budget_cost">
                                    </div>
                                </div>
                            </div>



                            <!-- step three -->
                            <div class="step">
                                <div class="row mb-3">
                                    <div class="col">
                                        <label for="contractoremail" class="form-label">Contractor</label>
                                        <select class="form-select" id="allocated_contractor_id">
                                            <option selected value="0">Choose Contractor...</option>
                                            @foreach (var monitoringViewModel in Model)
                                            {
                                                foreach (var contractorModel in monitoringViewModel.contractorList)
                                                {
                                                    <option value="@contractorModel.contractor_id">@contractorModel.email_id</option>
                                                }

                                            }
                                        </select>
                                    </div>
                                    <div class="col">
                                        <label for="ward" class="form-label">Ward</label>
                                        <select class="form-select" id="ward_id">
                                            <option selected value="0">Choose Ward...</option>
                                            @foreach (var monitoringViewModel in Model)
                                            {
                                                foreach (var wardModel in monitoringViewModel.wardList)
                                                {
                                                    <option value="@wardModel.ward_id">@wardModel.ward_name</option>
                                                }

                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col">
                                        <label for="approvalletter" class="form-label">Approval Letter</label>
                                        <input type="file" class="form-control" id="approval_letter">
                                    </div>
                                    <div class="col">
                                        <label for="tenderdoc" class="form-label">Tender Document</label>
                                        <input type="file" class="form-control" id="tender_doc">
                                    </div>
                                </div>
                                <div class="row mb-3" id="status_div">
                                    <div class="col">
                                        <label for="ward" class="form-label">Status</label>
                                        <select class="form-select" id="status">
                                            <option selected>Status...</option>
                                            <option value="1">Pending</option>
                                            <option value="2">On Going</option>
                                            <option value="3">Completed</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- start previous / next buttons -->
                            <!-- end previous / next buttons -->


                        </div>
                        <div class="modal-footer form-footer d-flex">
                            <button type="button" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
                            <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
                            <button type="button" id="submitBtn">Submit</button>

                        </div>
                    </div>

                </div>
            </div>
        </form>

        <!--img Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <!-- Modal content goes here -->
                    <img id="appletter" />
                </div>
            </div>
        </div>

        <!-- Button trigger modal -->
        <div class="container">
            <div class="table-responsive mt-4">
                <table id="table_d" class="table table-striped nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th>Sr.no</th>
                            <th>Project Title</th>
                            <th>Work Order No</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Status</th>
                            <th>Project Type</th>
                            <th>Ward</th>
                            <th>Approval Letter</th>
                            <th>Tender Document</th>
                            <th class="col-2">Project Allotted to<span class="break">Name</span></th>
                            <th class="col-2">Project Allotted to<span class="break">Contact Number</span></th>
                            <th>Action</th>
                        </tr>
                    </thead>

                    <tbody>
                        @{
                            var counter = 1;
                        }

                        @foreach (var monitoringViewModel in Model)
                        {

                            foreach (var projectModel in monitoringViewModel.projectList)
                            {


                                <tr>
                                    <input type="hidden" class="projectid" value="@projectModel.project_id" />
                                    <td id="prjid">@counter</td>
                                    <td>@projectModel.project_title</td>
                                    <td>@projectModel.work_order_no</td>
                                    <td>@projectModel.start_date</td>
                                    <td>@projectModel.end_date</td>
                                    <td>@projectModel.status</td>
                                    <td>@projectModel.project_type</td>
                                    <td>@projectModel.ward_name</td>


                                    @*<td><a href="#">View</a></td>*@
                                    <td class="text-center">
                                        <button href="#" class="view-link custom-btn" data-toggle="modal" data-target="#myModal" id="approvalid" value="~/approvalLetters/@projectModel.approval_letter_s">View</button>
                                    </td>
                                    <td><a download="~/tenderDocs/@projectModel.tender_doc_s" href="~/tenderDocs/@projectModel.tender_doc_s">Download</a></td>
                                    <td>@projectModel.project_alloted_name</td>
                                    <td>@projectModel.project_alloted_contact</td>
                                    <td>
                                        <button data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="editBtn(this);" type="button" class="btn btn-primary">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-danger" onclick="disableProject(this);">
                                            <i class="fas fa-trash-alt"></i> <!-- Delete icon -->
                                        </button>
                                    </td>
                                </tr>
                                counter++;
                            }

                        }
                    </tbody>
                    <tfoot>
                        <tr>
                            <th>Sr.no</th>
                            <th>Project Title</th>
                            <th>Work Order No</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Status</th>
                            <th>Approval Letter</th>
                            <th>Tender Document</th>
                            <th class="col-2">Project Allotted to<span class="break">Name</span></th>
                            <th class="col-2">Project Allotted to<span class="break">Contact Number</span></th>
                            <th>Action</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    }

    @if (ViewBag.RoleId == 3 || ViewBag.RoleId == 4)
    {

        <div class="container-fluid">
            <div class="d-flex">
                <a class="navbar-brand mr-auto" href="#"><h2>Project Details</h2></a>

                @if (ViewBag.RoleId == 3)
                {
                    <div class="d-flex">

                        <button class="btn btn-custom mx-2" id="getCSV">
                            <i class="fas fa-file-csv"></i> Export to CSV
                        </button>
                        <button class="btn btn-custom mx-2" id="getPDF">
                            <i class="fas fa-file-pdf"></i> Export to PDF
                        </button>
                    </div>

                }
            </div>
        </div>


        if (TempData["addSuggestion"] != null)
        {
            <div class="alert alert-dismissible" role="alert" style="background-color:#d1e7dd;">
                <strong style="color: #0f5132">@TempData["addSuggestion"]</strong>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>
            </div>
        }

        <!--feedback mmodal -->
        <form role="form" name="FeedbackForm" id="FeedbackForm" method="post">
            <div class="modal fade FeedbackModal" id="FeedbackModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title fs-5"> Feedback/Suggestion </h3>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="Feedback">

                                <div class="row mb-3">
                                    <div class="form-group  col">
                                        <label for="Fid"><i class="fa-solid fa-address-book"></i>&nbsp; Project Id</label>
                                        <input type="number" class="form-control" id="Fid" disabled>
                                    </div>
                                    <div class="form-group  col">
                                        <label for="Fname"><i class="fa-solid fa-address-book"></i>&nbsp; Project Name</label>
                                        <input type="text" class="form-control" id="Fname" disabled>

                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col">
                                        <label for="description" class="form-label">Description</label>
                                        <textarea class="form-control" id="description"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer form-footer d-flex">

                            <button type="submit" id="FeedbackBtn"><span class="glyphicon glyphicon-off"></span>Send</button>
                            <button type="submit" id="FeedbackBtnclose"><span class="glyphicon glyphicon-off"></span>Cancel</button>

                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!--img Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <!-- Modal content goes here -->
                    <img id="appletter" />
                </div>
            </div>
        </div>

        <!-- Button trigger modal -->
        <div class="container">
            <div class="table-responsive mt-4">
                @if (ViewBag.RoleId == 3)
                {
                    <table id="table_d" class="table table-striped nowrap" style="width:100%">
                        <thead>
                            <tr class="text-center">
                                <th class="text-center">Sr.no</th>
                                <th class="text-center">Project Title</th>
                                <th class="text-center">Work Order No</th>
                                <th class="text-center">Start Date</th>
                                <th class="text-center">End Date</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Project Type</th>
                                <th class="text-center">Ward</th>
                                <th class="text-center">Approval Letter</th>
                                <th class="text-center">Tender Document</th>
                                <th class="text-center">Project Allotted to<span class="break">Name</span></th>
                                <th class="text-center">Project Allotted to<span class="break">Contact Number</span></th>
                                @*<th>Action</th>*@
                            </tr>
                        </thead>

                        <tbody>
                            @{
                                var counter = 1;
                            }

                            @foreach (var monitoringViewModel in Model)
                            {

                                foreach (var projectModel in monitoringViewModel.projectList)
                                {

                                    <tr class="text-center">
                                        <input type="hidden" class="projectid" value="@projectModel.project_id" />

                                        <td id="prjid" class="text-center">@counter</td>
                                        <td class="text-center">@projectModel.project_title</td>
                                        <td class="text-center">@projectModel.work_order_no</td>
                                        <td class="text-center">@projectModel.start_date</td>
                                        <td class="text-center">@projectModel.end_date</td>
                                        <td class="text-center">@projectModel.status</td>
                                        <td class="text-center">@projectModel.project_type</td>
                                        <td class="text-center">@projectModel.ward_name</td>
                                        @*<td><a href="#">View</a></td>*@
                                        <td class="text-center"><button href="#" class="view-link" data-toggle="modal" data-target="#myModal" id="approvalid" value="~/approvalLetters/@projectModel.approval_letter_s">View</button></td>

                                        <td class="text-center"><a download="~/tenderDocs/@projectModel.tender_doc_s" href="~/tenderDocs/@projectModel.tender_doc_s">Download</a></td>
                                        <td class="text-center">@projectModel.project_alloted_name</td>
                                        <td class="text-center">@projectModel.project_alloted_contact</td>
                                        @*<td>
                                                <button data-bs-toggle="modal" data-bs-target="#FeedbackModal" type="button" class="btn btn-primary" id="Feedbackid_@projectModel.project_id" onclick="FeedbackDetails(this);">
                                                    Feedback
                                                </button>
                                            </td>*@
                                    </tr>
                                    counter++;
                                }

                            }
                        </tbody>
                    </table>
                }
                @if (ViewBag.RoleId == 4)
                {
                    <table id="table_d" class="table table-striped nowrap" style="width:100%">
                        <thead>
                            <tr class="text-center">
                                <th class="text-center">Sr.no</th>
                                <th class="text-center">Project Title</th>
                                <th class="text-center">Work Order No</th>
                                <th class="text-center">Start Date</th>
                                <th class="text-center">End Date</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Project Type</th>
                                <th class="text-center">Ward</th>
                                <th class="text-center">Contractor<span class="break">Name</span></th>
                                <th class="text-center">Contractor<span class="break">Contact Number</span></th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>

                        <tbody>
                            @{
                                var counter = 1;
                            }

                            @foreach (var monitoringViewModel in Model)
                            {

                                foreach (var projectModel in monitoringViewModel.projectList)
                                {

                                    <tr class="text-center">
                                        <input type="hidden" class="projectid" value="@projectModel.project_id" />

                                        <td id="prjid" class="text-center">@counter</td>
                                        <td class="text-center">@projectModel.project_title</td>
                                        <td class="text-center">@projectModel.work_order_no</td>
                                        <td class="text-center">@projectModel.start_date</td>
                                        <td class="text-center">@projectModel.end_date</td>
                                        <td class="text-center">@projectModel.status</td>
                                        <td class="text-center">@projectModel.project_type</td>
                                        <td class="text-center">@projectModel.ward_name</td>
                                        <td class="text-center">@projectModel.project_alloted_name</td>
                                        <td class="text-center">@projectModel.project_alloted_contact</td>
                                        <td>
                                            <button data-bs-toggle="modal" data-bs-target="#FeedbackModal" type="button" class="btn btn-primary" id="Feedbackid_@projectModel.project_id" onclick="FeedbackDetails(this);">
                                                Feedback
                                            </button>
                                        </td>
                                    </tr>
                                    counter++;
                                }

                            }
                        </tbody>
                    </table>
                }

            </div>
        </div>
    }
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.bootstrap5.js"></script>
    <!-- OpenLayers JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v9.1.0/dist/ol.js"></script>
    <script>

        function addPrj() {
            var divToHide = document.getElementById("status_div");

            // Set its display property to 'none' to hide it
            divToHide.style.display = "none";



            $('#project_title').val("");
            $('#work_order_no').val("");

            $('#description').val("");

            $('#start_date').val("");
            document.getElementById('start_date').value = "";
            document.getElementById('end_date').value = "";
            $('#s_latitude').val("");

            $('#s_longitude').val("");


            $('#e_latitude').val("");

            $('#e_longitude').val("");

            $('#project_type').val(0);
            $('#budget_cost').val("");

            $('#allocated_contractor_id').val(0);

            $('#ward_id').val(0);
        }

        var currentTab = 0; // Current tab is set to be the first tab (0)
        showTab(currentTab); // Display the current tab

        function showTab(n) {
            // This function will display the specified tab of the form...
            var x = document.getElementsByClassName("step");
            x[n].style.display = "block";
            console.log("length : ", x.length);
            //... and fix the Previous/Next buttons:
            if (n == 0) {
                document.getElementById("prevBtn").style.display = "none";
                document.getElementById("submitBtn").style.display = "none";
                document.getElementById("nextBtn").style.display = "inline";
            } else if (n == (x.length - 1)) {
                document.getElementById("prevBtn").style.display = "inline";
                document.getElementById("nextBtn").style.display = "none";
                document.getElementById("submitBtn").style.display = "inline";

            } else {
                document.getElementById("prevBtn").style.display = "inline";
                document.getElementById("submitBtn").style.display = "none";
                document.getElementById("nextBtn").style.display = "inline";
            }
            //... and run a function that will display the correct step indicator:
            fixStepIndicator(n)
        }

        function nextPrev(n) {
            // This function will figure out which tab to display
            var x = document.getElementsByClassName("step");

            // Exit the function if any field in the current tab is invalid:
            if (n == 1 && !validateForm()) return false;
            // Hide the current tab:
            x[currentTab].style.display = "none";
            // Increase or decrease the current tab by 1:
            currentTab = currentTab + n;
            // if you have reached the end of the form...
            if (currentTab >= x.length) {
                // ... the form gets submitted:
                document.getElementById("addProjectForm").submit();
                return false;
            }
            // Otherwise, display the correct tab:
            console.log("current tab : ", currentTab)
            showTab(currentTab);

        }

        function validateForm() {
            //console.log("inside validate form");
            var x, y, valid = true;
            x = document.getElementsByClassName("step");
            y = x[currentTab].querySelectorAll("input, textarea, select");
            for (let i = 0; i < y.length; i++) {

                if (y[i].value.trim() === "") {
                    //console.log("y[i]", y[i]);
                    //lbl = document.getElementById(y[i].id + "_label");
                    //console.log("lbl : ", lbl.innerHTML);
                    //document.getElementById(y[i].id + "_error").innerHTML = "Please Enter " + lbl.innerHTML +".";
                    //$("project_title_error").html("You can not keep it empty..!");
                    //if (y[i].id === "project_title") {
                    //    document.getElementById(y[i].id + "_error").innerHTML = "Please Enter Project Title!!";
                    //}
                    //else {
                    //    document.getElementById(y[i].id + "_error").innerHTML = "";

                    //}
                    // if (y[i].id === "work_order_no") {
                    //    document.getElementById(y[i].id + "_error").innerHTML = "Please Enter Work Order no!!";

                    // }
                    // else {
                    //     document.getElementById(y[i].id + "_error").innerHTML = "";

                    // }
                    // if (y[i].id === "description") {
                    //    document.getElementById(y[i].id + "_error").innerHTML = "Please Enter Description!!";

                    // }
                    // else {
                    //     document.getElementById(y[i].id + "_error").innerHTML = "";

                    // }
                    // if (y[i].id === "start_date") {
                    //    document.getElementById(y[i].id + "_error").innerHTML = "Please Enter Start Date!!";

                    //}
                    // else {
                    //     document.getElementById(y[i].id + "_error").innerHTML = "";

                    // }
                    //if (y[i].id === "end_date") {
                    //    document.getElementById(y[i].id + "_error").innerHTML = "Please Enter End Date!!";

                    //}
                    //else {
                    //    document.getElementById(y[i].id + "_error").innerHTML = "";

                    //}
                    //else if (y[i].id === "s_latitude" || y[i].id === "s_longitude" || y[i].id === "e_latitude" || y[i].id === "e_longitude") {
                    //    document.getElementById(y[i].id + "_error").innerHTML = "Please Select Path!!";
                    //}

                    //else if (y[i].id === "budget_cost") {
                    //    document.getElementById(y[i].id + "_error").innerHTML = "Please Enter Budget Cost!!";

                    //}

                    y[i].classList.add("invalid");

                    valid = false;
                } else {
                    y[i].classList.remove("invalid");
                    //document.getElementById(y[i].id + "_error").innerHTML = "";
                    //document.getElementById(y[i].id + "_error").innerHTML = " ";
                }

                if (y[i].id === "end_date" && y[i].value !== "" && y[i].value < y[i - 1].value) {
                    y[i].classList.add("invalid");
                    valid = false;
                }
                if (y[i].id === "budget_cost") {
                    if (y[i].value <= 0) {
                        y[i].classList.add("invalid");
                        valid = false;
                    }
                    else {
                        y[i].classList.remove("invalid");

                    }
                }

                // Specific validation for the select element
                if (y[i].id === "project_type") {
                    console.log("Project type ...!!");
                    if (y[i].value == 0 || y[i].value > 4) {
                        y[i].classList.add("invalid");
                        valid = false;
                    } else {
                        y[i].classList.remove("invalid");
                    }
                }

                //if (y[i].id === "allocated_contractor_id") {
                //    console.log("inside allocated contractor id");
                //    if (y[i].value == 0) {
                //        y[i].classList.add("invalid");
                //        valid = false;
                //    } else {
                //        y[i].classList.remove("invalid");
                //    }

                //}


            }

            if (valid) {
                document.getElementsByClassName("stepIndicator")[currentTab].classList.add("finish");
            }

            return valid;
        }


        //function validateForm() {
        //    // This function deals with validation of the form fields
        //    var x, y, i, valid = true;
        //    x = document.getElementsByClassName("step");
        //    y = x[currentTab].getElementsByTagName("input");


        //    for (i = 0; i < y.length; i++) {
        //        // If a field is empty...
        //        if (y[i].value == "") {
        //            // add an "invalid" class to the field:
        //            y[i].className += " invalid";
        //            // and set the current valid status to false
        //            valid = false;
        //        }
        //    }
        //    // If the valid status is true, mark the step as finished and valid:
        //    if (valid) {
        //        document.getElementsByClassName("stepIndicator")[currentTab].className += " finish";
        //    }
        //    return valid; // return the valid status
        //}

        function fixStepIndicator(n) {
            // This function removes the "active" class of all steps...
            var i, x = document.getElementsByClassName("stepIndicator");
            for (i = 0; i < x.length; i++) {
                x[i].className = x[i].className.replace(" active", "");
            }
            //... and adds the "active" class on the current step:
            x[n].className += " active";
        }
    </script>

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js" integrity="sha384-XXXXXXXXXX" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.bootstrap5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.14/jspdf.plugin.autotable.min.js"></script>
    <!-- Corrected -->
    <!-- OpenLayers JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v9.1.0/dist/ol.js"></script>
    <script>
        // JavaScript code
        // Initialize DataTable
        $(document).ready(function () {
            new DataTable('#table_d', {
                searchPanes: true,
                dom: 'Plfrtip',
                language: {
                    searchPanes: {
                        emptyPanes: ''
                    }
                }
            });

            // JavaScript code for creating the map
            const layers = [
                new ol.layer.Tile({
                    source: new ol.source.OSM(),
                }),
            ];
            const map = new ol.Map({
                layers: layers,
                target: 'map',
                view: new ol.View({
                    center: ol.proj.fromLonLat([72.5714, 23.0225]),
                    zoom: 12, // Increased zoom level
                }),
            });

            // Create a vector layer for drawing and selecting features
            const vectorSource = new ol.source.Vector();
            const vectorLayer = new ol.layer.Vector({
                source: vectorSource,
            });
            map.addLayer(vectorLayer);

            const draw = new ol.interaction.Draw({
                type: 'LineString',
                source: vectorSource,
            });
            map.addInteraction(draw);

            // Listen for drawend event to capture coordinates
            draw.on('drawend', function (event) {
                const feature = event.feature;
                const geometry = feature.getGeometry();
                const coordinates = geometry.getCoordinates();
                // Get the first and last coordinates
                const firstCoordinate = coordinates[0];
                const lastCoordinate = coordinates[coordinates.length - 1];
                document.getElementById('s_latitude').value = firstCoordinate[1].toString();
                document.getElementById('s_longitude').value = firstCoordinate[0].toString();
                document.getElementById('e_latitude').value = lastCoordinate[1].toString();
                document.getElementById('e_longitude').value = lastCoordinate[0].toString();


                const geoJsonObject = new ol.format.GeoJSON().writeFeaturesObject([feature]);
                console.log(geoJsonObject);
                document.getElementById('road_data_hidden').value = JSON.stringify(geoJsonObject);

            });

            // Create a select interaction for selecting features
            const select = new ol.interaction.Select();
            map.addInteraction(select);

            // Listen for select event to capture selected feature coordinates
            select.on('select', function (event) {
                const selectedFeatures = event.selected;
                if (selectedFeatures.length > 0) {
                    const selectedFeature = selectedFeatures[0];
                    const coordinates = selectedFeature.getGeometry().getCoordinates();
                }
            });



            $('#exampleModal').on('shown.bs.modal', function () {
                map.updateSize(); // Update the map size
                map.getView().fit(map.getLayers().getArray()[0].getSource().getExtent(), {
                    padding: [10, 10, 10, 10], // Padding around the extent
                });
            });

            $('#map_submit').click(() => {
                $('#mapModal').modal('hide');
                $('#exampleModal').modal('show');
            });
        });
        $("[id$=approvalid]").on("click", function (e) {
            var appid = $(this).attr('value');
            $("#appletter").attr("src", appid);
            console.log(appid);
        });

        var isEdit = false;
        var projectId = 0;
        var td;
        var ap;
        function editBtn(btn) {
            //alert("btnnn : "+btn)
            var divToHide = document.getElementById("status_div");

            // Set its display property to 'none' to hide it
            divToHide.style.display = "block";

            var button = document.getElementById("submitBtn");
            button.innerHTML = "Edit";
            projectId = btn.closest('tr').querySelector(".projectid").value;
            //console.log("btn", btn.value());

            isEdit = true;
            $.ajax({
                type: "POST",
                url: "/Admin/getProjectById/" + projectId,

                success: function (response) {
                    // Handle the response data
                    console.log("resp : :", response.project[0].start_date);
                    $('#project_title').val(response.project[0].project_title);
                    $('#work_order_no').val(response.project[0].work_order_no);

                    $('#description').val(response.project[0].description);

                    $('#start_date').val(response.project[0].start_date.toString());
                    //var timestamp = response.project[0].start_date;
                    ////var date = new Date(parseInt(timestamp.substr(6)));

                    //console.log("timestamp", timestamp.toString());
                    ////var day = date.getDate();
                    //const today = new Date();

                    //// Format date as YYYY-MM-DD (required format for input type="date")
                    //const formattedDate = timestamp.toISOString().slice(0, 10);
                    //console.log("formatted date  : ", formattedDate);
                    var s = response.project[0].start_date;
                    var ts = s.substring(s.indexOf('(') + 1, s.lastIndexOf(')'));
                    var date = new Date(Number(ts));
                    date.setUTCDate(date.getUTCDate() + 1); // Add one day
                    var formattedDate = date.toISOString().slice(0, 10);
                    document.getElementById('start_date').value = formattedDate;


                    var s = response.project[0].end_date;
                    var ts = s.substring(s.indexOf('(') + 1, s.lastIndexOf(')'));
                    var date = new Date(Number(ts));
                    date.setUTCDate(date.getUTCDate() + 1); // Add one day
                    var formattedDate = date.toISOString().slice(0, 10);
                    document.getElementById('end_date').value = formattedDate;


                    $('#s_latitude').val(response.project[0].s_latitude.toString());

                    $('#s_longitude').val(response.project[0].s_longitude.toString());


                    $('#e_latitude').val(response.project[0].e_latitude.toString());

                    $('#e_longitude').val(response.project[0].e_longitude.toString());
                    //console.log("proj type : ", response.project[0].project_type.toString());
                    $('#project_type').val(response.project[0].project_type.toString());
                    $('#budget_cost').val(response.project[0].budget_cost);

                    $('#allocated_contractor_id').val(response.project[0].allocated_contractor_id);

                    $('#ward_id').val(response.project[0].ward_id);
                    $('#status').val(response.project[0].status);

                    td = response.project[0].tender_doc_s;
                    ap = response.project[0].approval_letter_s;


                    //var date = new Date(response.project[0].start_date);
                    //var day = date.getDate();
                    /*  debugger;*/
                    //console.log("day : ", day);
                    //console.log("date : ", date);

                    //$('#end_date').val(end_date);

                    //$('#work_order_no').val(work_order_no);

                    // You can process the response data here
                },
                error: function (xhr, status, error) {
                    // Handle errors
                    console.error(xhr.responseText);
                }
            });


            //button.id = "editButton";
            //alert("Btn" + isEdit);
            //alert("id : "+ projectId);
            /* alert("inside edit btn");*/

        }

        function disableProject(btn) {

            var ok = confirm("Are you sure you want to disable this project?");
            if (ok) {
                projectId = $(btn).closest('tr').find('td:eq(0)').text().trim();
                var form_data = new FormData();
                form_data.append("projectId", projectId);
                alert(projectId)
                $.ajax({
                    type: "POST",
                    url: "/Admin/disableProject",
                    data: form_data,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        alert("project disabled successfully...!!");
                        console.log(response);
                        window.location.href = "/Admin/Project_MonitoringView";
                    }

                })

            }
            else {

            }
        }

        $("[id$=submitBtn]").on("click", function (e) {
            /*   e.preventDefault();*/

            //alert("isBtn : "+ isEdit);


            //validation for step 3 of modal
            var valid = true;
            var contractor_id = document.getElementById("allocated_contractor_id");
            var wrdid = document.getElementById("ward_id");
            var apid = document.getElementById("approval_letter");
            var tndr = document.getElementById("tender_doc");
            //console.log("apid: ", apid.value);

            if (contractor_id.value == 0) {
                contractor_id.classList.add("invalid");
                valid = false;
            }
            else {
                contractor_id.classList.remove("invalid");
            }
            if (wrdid.value == 0) {
                wrdid.classList.add("invalid");
                valid = false;
            }
            else {
                wrdid.classList.remove("invalid");
            }

            if (apid.value == "" && !isEdit) {
                apid.classList.add("invalid");
                valid = false;
            }
            else {
                apid.classList.remove("invalid");
            }
            if (tndr.value == "" && !isEdit) {
                tndr.classList.add("invalid");
                valid = false;
            }
            else {
                tndr.classList.remove("invalid");
            }


            if (valid) {



                if (!isEdit) {

                    var form_data = new FormData(); // Create a FormData object

                    // Append form fields to FormData object
                    form_data.append("project_title", $("[id$=project_title]").val());
                    form_data.append("work_order_no", $("[id$=work_order_no]").val());
                    form_data.append("description", $("[id$=description]").val());
                    form_data.append("start_date", $("[id$=start_date]").val());
                    form_data.append("end_date", $("[id$=end_date]").val());
                    form_data.append("s_latitude", $("[id$=s_latitude]").val());
                    form_data.append("s_longitude", $("[id$=s_longitude]").val());
                    form_data.append("e_latitude", $("[id$=e_latitude]").val());
                    form_data.append("e_longitude", $("[id$=e_longitude]").val());
                    form_data.append("project_type", $("[id$=project_type]").val());
                    form_data.append("budget_cost", $("[id$=budget_cost]").val());
                    form_data.append("allocated_contractor_id", $("[id$=allocated_contractor_id]").val());
                    form_data.append("ward_id", $("[id$=ward_id]").val());
                    var roddata = $("[id$=road_data_hidden]").val().toString();


                    form_data.append("road_data", $("[id$=road_data_hidden]").val().toString());
                    var tender_doc = document.getElementById("tender_doc").files[0]; //file
                    var approval_letter = document.getElementById("approval_letter").files[0]; //file
                    form_data.append("tender_doc", tender_doc);
                    form_data.append("approval_letter", approval_letter);
                    console.log("file : ", form_data);

                    $.ajax({
                        type: "POST",
                        url: "/Admin/addProject",
                        data: form_data,
                        processData: false,  // Don't process the data
                        contentType: false,  // Don't set contentType
                        success: function (response) {
                            alert("project added successfully...!!");
                            console.log(response);
                            window.location.href = "/Admin/Project_MonitoringView";
                        }
                    });
                }
                else {
                    //let id = $(btn).closest('tr').find('td:eq(0)').text().trim();

                    //alert("edit button event" + projectId);



                    var form_data = new FormData(); // Create a FormData object

                    form_data.append("project_id", projectId);

                    form_data.append("project_title", $("[id$=project_title]").val());
                    form_data.append("work_order_no", $("[id$=work_order_no]").val());
                    form_data.append("description", $("[id$=description]").val());
                    form_data.append("start_date", $("[id$=start_date]").val());
                    form_data.append("end_date", $("[id$=end_date]").val());
                    form_data.append("s_latitude", $("[id$=s_latitude]").val());
                    form_data.append("s_longitude", $("[id$=s_longitude]").val());
                    form_data.append("e_latitude", $("[id$=e_latitude]").val());
                    form_data.append("e_longitude", $("[id$=e_longitude]").val());
                    form_data.append("project_type", $("[id$=project_type]").val());
                    form_data.append("budget_cost", $("[id$=budget_cost]").val());
                    form_data.append("allocated_contractor_id", $("[id$=allocated_contractor_id]").val());
                    form_data.append("ward_id", $("[id$=ward_id]").val());
                    form_data.append("status", $("[id$=status]").val());
                    form_data.append("road_data", $("[id$=road_data_hidden]").val().toString());

                    var tender_doc = document.getElementById("tender_doc").files[0]; //file

                    var approval_letter = document.getElementById("approval_letter").files[0]; //file

                    //alert("before if : " + tender_doc)
                    //debugger;
                    if (tender_doc != undefined) {
                        //alert("inside tender_doc")
                        form_data.append("tender_doc", tender_doc);
                    }
                    else {
                        //alert("td : " + td)
                        form_data.append("tender_doc_s", td);

                    }
                    if (approval_letter) {
                        form_data.append("approval_letter", approval_letter);
                    }
                    else {
                        form_data.append("approval_letter_s", ap);
                    }



                    $.ajax({
                        type: "POST",
                        url: "/Admin/updateProject",
                        data: form_data,
                        processData: false,
                        contentType: false,
                        success: function (response) {
                            alert("project updated successfully...!!");
                            console.log(response);
                            window.location.href = "/Admin/Project_MonitoringView";
                        }

                    })



                }


            }
        });


        document.getElementById("getCSV").addEventListener("click", function () {
            // Get the table
            var table = document.getElementById("table_d");
            // Prepare the CSV data
            var csv = "";
            for (var i = 0; i < table.rows.length - 1; i++) {
                var rowData = [];
                var cells = table.rows[i].cells;
                for (var j = 0; j < cells.length - 1; j++) { // Exclude the last cell
                    if (j != 6 && j != 7) {
                        rowData.push(cells[j].innerText);
                    }
                }
                csv += rowData.join(",") + "\n";
            }

            // Create a Blob object from the CSV string
            var blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });

            // Create a download link
            var link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "table_data.csv";

            // Append the link to the body and trigger the click event
            document.body.appendChild(link);
            link.click();

            // Cleanup
            document.body.removeChild(link);
        });
        document.getElementById("getPDF").addEventListener("click", function () {
            // Get the table
            var table = document.getElementById("table_d");

            // Initialize jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Prepare the data
            var data = [];
            for (var i = 1; i < table.rows.length - 1; i++) {
                var rowData = [];
                var cells = table.rows[i].cells;
                for (var j = 0; j < cells.length - 1; j++) { // Exclude the last cell
                    if (j != 6 && j != 7) {
                        rowData.push(cells[j].innerText);
                    }
                }
                data.push(rowData);
            }

            //Set the table columns
            var columns = [];
            var headerCells = table.rows[0].cells;
            for (var i = 0; i < headerCells.length - 1; i++) { // Exclude the last header
                if (i != 6 && i != 7) {
                    columns.push(headerCells[i].innerText);
                }
            }

            // Add the table to the PDF
            doc.autoTable({
                head: [columns],
                body: data
            });

            // Save the PDF
            doc.save('table_data.pdf');
        });




        $('#Feedbackid').click(() => {
            $('#FeedbackModal').modal('show');
        });


        function FeedbackDetails(btn) {
            let project_id = $(btn).closest('tr').find('td:eq(0)').text().trim();
            let project_title = $(btn).closest('tr').find('td:eq(1)').text().trim(); // Assuming project title is in the second column
            let status = $(btn).closest('tr').find('td:eq(5)').text().trim();
            let contractor_name = $(btn).closest('tr').find('td:eq(8)').text().trim();
            let contractor_contact = $(btn).closest('tr').find('td:eq(9)').text().trim();

            // Data object to be sent in AJAX request
            let data = {
                project_id: project_id,
                project_title: project_title,
                status: status,
                project_alloted_name: contractor_name,
                project_alloted_contact: contractor_contact
            };

            // Click event handler for FeedbackBtn button
            $('#FeedbackBtn').click(function () {
                // Get the value of the description input field
                var comment = $('#description').val();
                // Add comment to the data object
                data.comment = comment;


                // AJAX request
                $.ajax({
                    type: "POST",
                    url: "/Admin/SuggestionView",
                    data: data,
                    success: function (response) {
                        console.log(response);
                    }
                });
            });
            $('#Fid').val(project_id);
            $('#Fname').val(project_title);
        }
    </script>
</body>
</html>